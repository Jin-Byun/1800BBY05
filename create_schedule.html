<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>Hej!</title>
  <meta name="comp1800 boilerplate code" content="width=device-width, initial-scale=1.0" />
  <meta name="author" content="BCIT" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

  <!-- Bootstrap, firebase-auth-ui -->
  <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.css" />

  <!-- Bootstrap FirebaseUI CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous" />

  <!-- Firebase 8 CDNs-->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous">
  </script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

  <!-- Link to the api keys for your firebase project -->
  <script src="scripts/firebaseAPI.js"></script>

  <!-- Optional styles and scripts of your own -->
  <!-- Google Icons (Material Design)-->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.6.0/font/bootstrap-icons.css" />
  <link rel="stylesheet" href="styles/my_style.css" />
  <link rel="stylesheet" href="styles/create_schedule.css" />

</head>

<body>
  <!-------------------------------------->
  <!-- The following is HTML for layout -->
  <!-------------------------------------->
  <!-- Header Navigation Bar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-secondary fixed-top">

    <div class="container-fluid">
      <a class="navbar-brand" href="frontpage.html"><span id="logo">HE J!</span></a>
    </div>

  </nav>

  <!-- The following is the input form for creating a new reminder -->
  <div class="container">

    <h1>Create a reminder</h1>
    <br>
    <!--fieldset for the three inputs-->
    <fieldset id="set-reminder" action="">
      <!--input form for reminder name-->
      <div class="form-control">
        <input id="reminder" type="text" required>
        <label>Reminder</label>
      </div>
      <!--input form for time of the reminder-->
      <div class="form-control">
        <input id="time" type="time" required>
        <label>Time for Reminder</label>
      </div>

      <div class="radio-button-form">
        <!--input form for frequency of reminder-->
        <label>Frequency of Reminder</label>
        <br>
        
        <input type="radio" name="options" id="option1" autocomplete="off" value="Daily" checked />
        <label>Daily</label>



        <input type="radio" name="options" id="option2" autocomplete="off" value="Weekly" checked />
        <label>Weekly</label>

        <input type="radio" name="options" id="option3" autocomplete="off" value="Bi-Weekly" checked />
        <label>Bi-Weekly</label>
        <br>

        <!-- calls the saveReminderInfo() function on click -->
        <button class="bttn" onclick="saveReminderInfo()">Submit</button>

      </div>

    </fieldset>


  </div>

  <!-- The following is the fixed bottom nav bar -->

  <div class="fixed-bottom">
    <footer class="navbar-bottom">


      <a id="first-icon" href="calendar.html" class="bi bi-calendar-date"></a>
      <a id="second-icon" href="create_schedule.html" class="bi bi-plus-circle"></a>
      <a id="third-icon" href="profile_user.html" class="bi bi-person"></a>


    </footer>
  </div>

  <!----------------------------------------------->
  <!-- JS: Boostrap, Firebase, API related, add Jquery    -->
  <!----------------------------------------------->

  <!--------------------------------------------------------------------->
  <!-- JS functions    -->
  <!--------------------------------------------------------------------->
  <script>

    //Wave Input Form Effect
    const labels = document.querySelectorAll('.form-control label')

    //for each label, the function splits the characters of the label and after 30ms will reform the labels
    labels.forEach(label => {
      label.innerHTML = label.innerText
        .split('')
        //.map accepts params letter for the character and idx for the index of the string
        .map((letter, idx) => `<span style="transition-delay:${idx * 30}ms">${letter}</span>`)
        .join('')
    })

    //var current user represents the current logged in user
    var currentUser;

    //var time represents the current date which is the time stamp for when theuser sets a reminder
    var time = Date.now || function () {
      console.log("TimeStamp works");
      return +new Date;
    };







    // Save Reminder Function  
    function saveReminderInfo() {
      //value of the reminder input
      let Name = document.getElementById("reminder").value;
      //value of the time input
      let Time = document.getElementById("time").value;
      //value of the checked button
      let Frequency = document.querySelector(
        'input[name="options"]:checked'
      ).value;

      //Authenticates the user
      firebase.auth().onAuthStateChanged((user) => {
        //If user exists
        if (user) {
          //Read the "user" collection for the user
          var currentUser = db.collection("users").doc(user.uid);
          var userID = user.uid;
          
          //Get the document for current user.
          currentUser.get().then((userDoc) => {
            //get user's Email
            var userEmail = userDoc.data().email;
            
            //Start a collection for the user then add the values.
            db.collection("reminders").add({
                UserID: userID,
                email: userEmail,
                Name: Name,
                Time: Time,
                Frequency: Frequency,
                TimeStamp: time(),
                Active: true
              })
              //.then() returns a promise, in this case a validateForm()
              .then(() => {
                validateForm();

              })
          });
        } else {
          // no user is signed in.
          console.log("no user signed in");
        }

      });
      //the input forms are not disabled unless the inputs are valid in which case we write the contents into the firestore
      document.getElementById("set-reminder").disabled = false;



    }

   

    //function that redirects to a page if inputs are not empty
    function redirect() {
      let Name = document.getElementById("reminder").value;
      let Time = document.getElementById("time").value;
      let Frequency = document.querySelector(
        'input[name="options"]:checked'
      ).value;

      //redirects the page to redirect.html and writes Name value to the other page
      window.location.href = "redirect.html?" + Name;


    }




    //Validate Form Function
    function validateForm() {
      //x as the value of reminder name
      let x = document.getElementById("reminder").value;
      //y as the value of the time input
      let y = document.getElementById("time").value;
      //alert if x is not valid
      if (!x) {
        alert("Reminder must have a name.");
        //form is not disabled so as to allow for correction
        document.getElementById("set-reminder").disabled = false;
        return false;
      }
      //alert if y is not valid
      if (!y) {
        alert("Time of the reminder must be provided.");
        //form is not disabled so as to allow for correction
        document.getElementById("set-reminder").disabled = false;
        return false;
      }

      //if x and y are valid then we can redirect
      if (x && y) {
        //function that redirects to the redirect.html page
        redirect();
      }
    }
  </script>
</body>

</html>