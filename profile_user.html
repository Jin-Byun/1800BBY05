<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Hej!</title>
    <meta name="comp1800 boilerplate code" content="my bcit project">
    <meta name="author" content="BCIT">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap, firebase-auth-ui -->
    <!-- <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/8.10.0/firebase-ui-auth.css" /> -->
    <!-- Bootstrap FirebaseUI CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">

    <!-- Optional styles and scripts of your own -->
    <!-- Google Icons (Material Design)-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.6.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="styles/my_style.css">

    <!-- Firebase 8 CDNs-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous">
    </script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <!-- <script src="https://www.gstatic.com/firebasejs/ui/8.10.0/firebase-ui-auth.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.6.0/dist/chart.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

    <!-- Firebase 8 related CSS CDN -->
    <!-- <link type="text/css" rel="stylesheet" 
    href="https://www.gstatic.com/firebasejs/ui/8.10.0/firebase-ui-auth.css" /> -->

    <!-- Link to the api keys for your Firebase project -->
    <script src="scripts/firebaseAPI.js"></script>

    <style>
        body {
            background-color: #fffaec;
        }

        .navbar {
            background-color: #5f7781 !important;
            background-color: #f5efdf !important;
            border-bottom: solid 2px #f37f5230;
        }

        .navbar-brand {
            font-size: 5vh;
            font-weight: bold;
            color: #f37f52 !important;
            word-spacing: -1vh;
            line-height: 0;
            padding-top: 1.4vh;
            padding-bottom: 2.3vh;
            text-shadow: 1px 0px yellow, 2px 0px 1px yellow, 2px 1px yellow, 1px 1px yellow, 2px 2px yellow, 3px 3px 1px #f37f52, 3px 0.5px 2px #f37f52;
        }

        .card.user-card {
            border-top: none;
            -webkit-box-shadow: 0 0 1px 2px rgba(0, 0, 0, 0.05), 0 -2px 1px -2px rgba(0, 0, 0, 0.04), 0 0 0 -1px rgba(0, 0, 0, 0.05);
            box-shadow: 0 0 1px 2px rgba(0, 0, 0, 0.05), 0 -2px 1px -2px rgba(0, 0, 0, 0.04), 0 0 0 -1px rgba(0, 0, 0, 0.05);
            -webkit-transition: all 150ms linear;
            transition: all 150ms linear;
        }

        .card {
            border-radius: 5px;
            -webkit-box-shadow: 0 1px 2.94px 0.06px rgba(4, 26, 55, 0.16);
            box-shadow: 0 1px 2.94px 0.06px rgba(4, 26, 55, 0.16);
            border: none;
            margin-bottom: 30px;
            -webkit-transition: all 0.3s ease-in-out;
            transition: all 0.3s ease-in-out;
        }

        .card .card-header {
            background-color: transparent;
            border-bottom: none;
            padding: 25px;
        }

        .card .card-header h5 {
            margin-bottom: 0;
            color: #222;
            font-size: 14px;
            font-weight: 600;
            display: inline-block;
            margin-right: 10px;
            line-height: 1.4;
        }

        .card .card-header+.card-block,
        .card .card-header+.card-block-big {
            padding-top: 0;
        }

        .user-card .card-block {
            text-align: center;
        }

        .card .card-block {
            padding: 25px;
        }

        .user-card .card-block .user-image {
            position: relative;
            margin: 0 auto;
            display: inline-block;
            padding: 5px;
            width: 110px;
            height: 110px;
            border-radius: 50%;
        }

        /* .user-card .card-block .user-image img {
            z-index: 20;
            position: absolute;
            top: 5px;
            left: 5px;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            
        } */

        .img-radius {
            border-radius: 50%;
        }

        .f-w-600 {
            font-weight: 600;
        }

        .m-b-10 {
            margin-bottom: 10px;
        }

        .m-t-25 {
            margin-top: 25px;
        }

        .m-t-15 {
            margin-top: 15px;
        }

        .card .card-block p {
            line-height: 1.4;
        }

        .text-muted {
            color: #919aa3 !important;
        }

        .user-card .card-block .activity-leval li.active {
            background-color: #ffa685;
        }

        .user-card .card-block .activity-leval li {
            display: inline-block;
            width: 15%;
            height: 4px;
            margin: 0 3px;
            background-color: #ccc;
        }

        .user-card .card-block .counter-block {
            color: #fff;
        }

        .bg-c-blue {
            background: linear-gradient(45deg, #f37f52, #73b4ff);
        }

        .bg-c-green {
            background: linear-gradient(45deg, #2ed8b6, #59e0c5);
        }

        .bg-c-yellow {
            background: linear-gradient(45deg, #FFB64D, #ffcb80);
        }

        .bg-c-pink {
            background: linear-gradient(45deg, #FF5370, #ff869a);
        }

        .m-t-10 {
            margin-top: 10px;
        }

        .p-20 {
            padding: 20px;
        }

        .user-card .card-block .user-social-link i {
            font-size: 30px;
        }

        .text-facebook {
            color: #3B5997;
        }

        .text-twitter {
            color: #42C0FB;
        }

        .text-dribbble {
            color: #EC4A89;
        }

        .user-card .card-block .user-image:before {
            bottom: 0;
            border-bottom-left-radius: 50px;
            border-bottom-right-radius: 50px;
        }


        .user-card .card-block .user-image:after {
            top: 0;
            border-top-left-radius: 50px;
            border-top-right-radius: 50px;
        }

        .user-card .card-block .user-image:after,
        .user-card .card-block .user-image:before {
            content: "";
            width: 100%;
            height: 48%;
            border: 1px solid #ffffff00;
            position: absolute;
            left: 0;
            z-index: 10;
        }

        .fixed-bottom {
            background-color: #f5efdf !important;
            border-top: solid 2px #f37f5230;
            border-left: solid 2px #f37f5230;
            border-right: solid 2px #f37f5230;
            justify-content: space-evenly;
            margin-left: 10rem;
            margin-right: 10rem;
        }

        footer>a {
            color: #f37f52;
            text-shadow: 1px 0px #f37f52, -1px 0px #f37f52, 0px 1px #f37f52, 0px -1px #f37f52;
        }
    </style>

</head>

<body>

    <!-------------------------------------->
    <!-- The following is HTML for layout -->
    <!-------------------------------------->
    <!-- Header Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-success">
        <div class="container-fluid">
            <a class="navbar-brand" href="./frontpage.html">HEJ!</a>
        </div>
    </nav>

    <!-- welcome and main part of the page -->
    <div id="firebaseui-auth-container"></div>

    <br><br>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css"
        integrity="sha256-h20CPZ0QyXlBuAw7A+KluUYx/3pK+c7lYEpqLTlxjYQ=" crossorigin="anonymous" />

    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

    <div class="container">
        <div class="row d-flex justify-content-center">
            <div class="col-md-4">
                <div class="card user-card">
                    <div class="card-header">
                        <h5></h5>
                    </div>
                    <div class="card-block">
                        <div class="user-image">
                            <div id="profile-img">
                                <img src="https://i.imgur.com/rTLjnCe.png" class="img-radius" alt="profile">

                                    <!-- Testing -->
                                    <input type="file" id="profile-img-file" style="display:none" accept="image/*">
                                    <img onclick="document.getElementById('profile-img-file').click()">

                            </div>
                        </div>
                        <h6 class="f-w-600 m-t-25 m-b-10 "></h6>
                        <p class="text-muted"><span id="name-goes-here"></span> | <span id="email-goes-here"></span> |
                            <span id="age-goes-here"></span></p>
                        <hr>
                        <p class="text-muted m-t-15">Progress Level:</p>
                        <ul class="list-unstyled activity-leval">
                            <li class="active"></li>
                            <li class="active"></li>
                            <li class="active"></li>
                            <li></li>
                            <li></li>
                        </ul>
                        <div class="bg-c-blue counter-block m-t-10 p-20">
                            <div class="row">
                                <div class="col-4">
                                    <!-- <i class="fa fa-comment"></i>
                                <p>3</p> -->
                                </div>
                                <div class="col-4">
                                    <!-- <i class="fa fa-user"></i>
                                <p>4</p> -->
                                </div>
                                <div class="col-4">
                                    <!-- <i class="fa fa-suitcase"></i>
                                <p>2</p> -->
                                </div>
                            </div>
                        </div>
                        <p class="m-t-15 text-muted">This user hasn't added a description</p>
                        <hr>

                    </div>
                </div>
            </div>


        </div>
    </div>



    <div class="fixed-bottom py-3 bg-secondary align-items-center">
        <div class="container text-center py-0">
            <footer class="navbar bg-secondary fixed-bottom py-0">

                <a href="calendar.html" class="bi bi-calendar-date" style="font-size: 2em; "></a>
                <a href="create_schedule.html" class="bi bi-plus-circle mx-3" style="font-size: 3em;"></a>

                <a href="profile_user.html" i class="bi bi-person mx-3" style="font-size: 2em;"></a>

            </footer>
        </div>
    </div>

    <!----------------------------------------------->
    <!-- JS: Boostrap, Firebase, API related, add Jquery    -->
    <!----------------------------------------------->
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous">
    </script>
    <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/ui/4.6.1/firebase-ui-auth.js"></script> -->

    <!--------------------------------------------------------------------->
    <!-- JS files: Your own JavaScript functions included here    -->
    <!--------------------------------------------------------------------->


    <script>
        function displayUserProfilePic() {

            firebase.auth().onAuthStateChanged(function (user) { //get user object
                db.collection("users").doc(user.uid) //use user's uid
                    .get() //READ the doc
                    .then(function (doc) {
                        var picUrl = doc.data().profilePic; //extract pic url

                        // use this line if "mypicdiv" is a "div"
                        $("#profile-img").append("<img src='" + picUrl + "'>")

                        // use this line if "mypic-goes-here" is an "img" 
                        //$("#profile-img").attr("src", picUrl);
                    })
            })
        }
        displayUserProfilePic();

        var currentUser;

        function populateInfo() {
            firebase.auth().onAuthStateChanged(user => {
                // Check if user is signed in:
                if (user) {

                    //go to the correct user document by referencing to the user uid
                    currentUser = db.collection("users").doc(user.uid)
                    //get the document for current user.
                    currentUser.get()
                        .then(userDoc => {
                            //get the data fields of the user
                            var userName = userDoc.data().name;
                            //console.log(userName);
                            var userAge = userDoc.data().age;

                            //if the data fields are not empty, then write them in to the form.
                            // if (userName != null) {
                            //     document.getElementById("nameInput").value = userName;
                            // }
                            // if (userAge != null) {
                            //     document.getElementById("ageInput").value = userAge;
                            // }
                            // if (userCity != null) {
                            //     document.getElementById("emailInput").value = userCity;
                            // }
                        })
                } else {
                    // No user is signed in.
                    console.log("No user is signed in");
                }
            });
        }

        //call the function to run it 
        populateInfo();

        function insertName() {
            firebase.auth().onAuthStateChanged(user => {
                // Check if user is signed in:
                if (user) {
                    // Do something for the current logged-in user here: 
                    //console.log(user.uid);
                    //go to the correct user document by referencing to the user uid
                    currentUser = db.collection("users").doc(user.uid)
                    //get the document for current user.
                    currentUser.get()
                        .then(userDoc => {
                            var user_Name = userDoc.data().name;
                            //console.log(user_Name);
                            //document.getElementById("username").innerText = n;                     
                            //using javascript
                            $("#name-goes-here").text(user_Name); //using jquery
                        })
                } else {
                    // No user is signed in.
                }
            });
        }
        insertName();

        function insertEmail() {
            firebase.auth().onAuthStateChanged(user => {
                // Check if user is signed in:
                if (user) {
                    // Do something for the current logged-in user here: 
                    //console.log(user.uid);
                    //go to the correct user document by referencing to the user uid
                    currentUser = db.collection("users").doc(user.uid)
                    //get the document for current user.
                    currentUser.get()
                        .then(userDoc => {
                            var user_Email = userDoc.data().email;
                            //console.log(user_Name);
                            //document.getElementById("username").innerText = n;                     
                            //using javascript
                            $("#email-goes-here").text(user_Email); //using jquery
                        })
                } else {
                    // No user is signed in.
                }
            });
        }
        insertEmail();


        function insertAge() {
            firebase.auth().onAuthStateChanged(user => {
                if (user) {
                    //console.log(user.uid);
                    db.collection("users").doc(user.uid).get().then(docs => {
                        if (docs.exists) {
                            //console.log("data:", docs.data().counter)
                        }
                        document.getElementById("age-goes-here").innerText = docs.data().age;
                        //console.log(age);
                    })
                }
            });
        }
        insertAge();

        function uploadUserProfilePic() {

            firebase.auth().onAuthStateChanged(function (user) {
                var fileInput = document.getElementById("profile-img-file"); // pointer #1
                const image = document.getElementById("profile-img"); // pointer #2

                // listen for file selection
                fileInput.addEventListener('change', function (e) {
                    var file = e.target.files[0];
                    var blob = URL.createObjectURL(file);
                    image.src = blob; // display this image

                    //store using this name

                    //*****************************************************
                    //*********************************************************
                    //JIn's opinion: The storageRef is referencing to a file that does not exists with in the storage.
                    //try copying a file in the storage to have the same name, and then put the new Item in to it.
                    var storageRef = storage.ref("images/" + user.uid + ".jpg");

                    storageRef.put(file)
                        .then(function () {
                            console.log('Uploaded to Cloud Storage.');
                        })

                    storageRef.getDownloadURL()
                        .then(function (url) { // Get URL of the uploaded file
                            console.log(url); // Save the URL into users collection
                            db.collection("users").doc(user.uid).update({
                                    "profilePic": url
                                })
                                .then(function () {
                                    console.log('Added Profile Pic URL to Firestore.');
                                })
                        })
                })
            })
        }
        uploadUserProfilePic();


        function showUploadedPicture() {
            const fileInput = document.getElementById("profile-img-file"); // pointer #1
            const image = document.getElementById("profile-img"); // pointer #2

            //attach listener to input file
            //when this file changes, do something
            fileInput.addEventListener('change', function (e) {

                //the change event returns a file "e.target.files[0]"
                var blob = URL.createObjectURL(e.target.files[0]);

                //change the DOM img element source to point to this file
                image.src = blob; //assign the "src" property of the "img" tag
            })
        }
        showUploadedPicture();
        
    </script>





</body>

</html>