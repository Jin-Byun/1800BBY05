<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>My BCIT Project</title>
    <meta name="comp1800 boilerplate code" content="my bcit project">
    <meta name="author" content="BCIT">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap, firebase-auth-ui -->
    <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.css" />

    <!-- Bootstrap FirebaseUI CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">

    <!-- Firebase 8 CDNs-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous">
    </script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>


    <!-- Link to the api keys for your firebase project -->
    <script src="scripts/firebaseAPI.js"></script>

    <!-- Optional styles and scripts of your own -->
    <!-- Google Icons (Material Design)-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.6.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="styles/my_style.css">

    <style>
        * {
            box-sizing: border-box;
        }

        #app-calendar {
            border: solid black 2px;
            height: 45vh;
            width: 80vw;
            margin: 0 10%;
            display: grid;
            overflow: hidden;
            text-align: center;
            grid-template-columns: repeat(7, 1fr);
            grid-template-rows: 8.8% repeat(6, 1fr);
        }

        .xtrablock {
            background-color: gray;
            color: white;
        }

        .block {
            background-color: whitesmoke;
            border: black solid 1px;
        }

        .weekend {
            color: red;
        }

        .date {
            background-color: ivory;
            margin: auto 0;
            border: black solid 1px;
            font-weight: bold;
        }

        .today {
            background-color: khaki;
            color: darkblue;
            font-weight: bold;
            border: solid blue 1px;
        }

        .selected {
            background-color: brown;
        }
    </style>

</head>

<body>

    <!-------------------------------------->
    <!-- The following is HTML for layout -->
    <!-------------------------------------->
    <!-- Header Navigation Bar -->
    <!-- Header Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-secondary">
        <div class="container-fluid">
            <a class="navbar-brand" href="#" style="color: white;">HEJ!</a>
            <a href="frontpage.html" type="button" class="btn btn-outline-dark" style="color: white;">Home</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <i class="bi bi-search" style="color: white;"></i>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <div style="float: right;">
                            <input id="title" type="text">
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- welcome and main part of the page -->
    <br />
    <div id="date" class="col" style="font-size: 4vw; font-weight: bold; margin-left: 10%; margin-bottom: 2%;"></div>

    <div id="app-calendar"></div>

    <br />
    <div class="row mx-5">
        <div class="col">
            <h1>Today's TO DO</h1>
        </div>
    </div>
    <div class="row mx-5">
        <div class="col-sm-1"></div>
        <div class="col-sm-7">
            <ul>
                <li>Eat lunch</li>
                <li>Walk the Dog</li>
                <li>Finish Assignment(due tmrw)</li>
            </ul>
        </div>
        <div class="col-sm-4 py-2"><input type="radio" class="btn-check a" name="btnradio" id="btnradio1"
                autocomplete="off" checked>
            <label class="btn btn-outline-secondary align-items-center" for="btnradio1">All Done</label></div>
    </div>
    <br />
    <div class="row mx-5">
        <div class="col">
            <h3>Quote of the day</h3>
        </div>
    </div>

    <div class="row mx-5">
        <div class="col">
            Lorem ipsum dolor sit amet consectetur adipisicing elit.
        </div>
    </div>

    <div style="height: 80px"></div>



    <div class="fixed-bottom py-3 bg-secondary align-items-center">
        <div class="container text-center py-0">
            <footer class="navbar bg-secondary fixed-bottom py-0">
                <a href="frontpage.html" i class="bi bi-arrow-left-circle mx-3 "
                    style="font-size:  2em; color: white"></a>
                <a href="calendar.html" class="bi bi-calendar-date" style="font-size: 2em; color: white;"></a>
                <a href="create_schedule.html" class="bi bi-plus-circle mx-3" style="font-size: 3em; color: white;"></a>
                <i class="bi bi-trophy" style="font-size: 2em; color: white;"></i>
                <a href="profile_user2.html" i class="bi bi-person mx-3" style="font-size: 2em; color: white"></a>

            </footer>
        </div>
    </div>

    <!----------------------------------------------->
    <!-- JS: Boostrap, Firebase, API related, add Jquery    -->
    <!----------------------------------------------->
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous">
    </script>
    <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/ui/4.6.1/firebase-ui-auth.js"></script> -->
    <!-- Link to the api keys for your firebase project -->
    <!-- <script src="scripts/firebase_api_elmo.js"></script> -->

    <!--------------------------------------------------------------------->
    <!-- JS files: Your own JavaScript functions included here    -->
    <!--------------------------------------------------------------------->
    <script>
        var userID
        const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September",
            "October", "November", "December"]
        const days = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"]
        const fulldays = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"]
        const monthdays = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31]

        let today = new Date(Date.now());
        let month = today.getMonth();
        let date = today.getDate();
        let year = today.getFullYear();
        let day = today.getDay();
        let firstday = new Date(year, month, 1);
        let lastday = new Date(year, month + 1, 0);

        const nth = function (d) {
            if (d > 3 && d < 21) return 'th';
            switch (d % 10) {
                case 1:
                    return "st";
                case 2:
                    return "nd";
                case 3:
                    return "rd";
                default:    
                    return "th";
            }
        }
        // adding dates into db collection.
        for (let i = 1; i <= monthdays[month]; i++) {
            firebase.auth().onAuthStateChanged(user => {
                    if (user) {
                        console.log(user.uid);
                        var currentUser = db.collection("users").doc(user.uid)
                        userID = user.uid;
                        //get the document for current user.
                        currentUser.get()
                            .then(userDoc => {
                                //get user name
                                userName = userDoc.data().name;
                                // Start a new collection and add all data in it.
                                let docData = {
                                    weekday: ((firstday.getDay() + i - 1) % 7),
                                    activity: [],
                                    name: userName
                                };
                                db.collection("dates").doc(userID)
                                .collection(months[month]+"_"+year)
                                .doc(i.toString()).set(docData).then(() => {
                                        console.log("Document successfully written!");
                                    });
                            })
                    } else {}
                })}
            console.log(userID);

            document.getElementById("date").innerHTML = year + " " + months[month] + " " + date + nth(date) + ", " +
                fulldays[day];

            const isWeekend = block => {
                return block % 7 === ((1 + (7 - firstday.getDay())) % 7) || block % 7 === (7 - firstday.getDay());
            }

            const istoday = block => {
                return block === date;
            }

            const calendar = document.querySelector("#app-calendar");

            for (let i = 0; i < 7; i++) {
                calendar.insertAdjacentHTML("beforeend",
                    `<div class="date ${i == 0 || i == 6 ? "weekend" : ""}">${days[i]}</div>`);
            }

            for (let xtrablock = 0; xtrablock < firstday.getDay(); xtrablock++) {
                calendar.insertAdjacentHTML("beforeend",
                    `<div class="xtrablock">${monthdays[month - 1] + (xtrablock - firstday.getDay())}</div>`);
            }

            for (let block = 1; block <= monthdays[month]; block++) {

                const weekend = isWeekend(block)
                const now = istoday(block)

                console.log(block)
                calendar.insertAdjacentHTML("beforeend",
                    `<div id="${year}_${months[month]}_${block}" class="${(firstday.getDay() + block - 1) % 7} block ${weekend ? "weekend" : ""} ${now ? "today" : ""}">${block}</div>`
                );
            }
            if (firstday.getDay() == 5 && monthdays[month] > 30 || firstday.getDay() == 6 && monthdays[month] >= 30) {
                for (let xtrablock = lastday.getDay() + 1; xtrablock < 7; xtrablock++) {
                    calendar.insertAdjacentHTML("beforeend",
                        `<div class="xtrablock">${xtrablock - lastday.getDay()}</div>`);
                }
            } else {
                for (let xtrablock = lastday.getDay() + 1; xtrablock < 14; xtrablock++) {
                    calendar.insertAdjacentHTML("beforeend",
                        `<div class="xtrablock">${xtrablock - lastday.getDay()}</div>`);
                }
            }

            document.querySelectorAll("#app-calendar .block").forEach(block => {
                block.addEventListener("click", e => {
                    e.currentTarget.classList.toggle("selected");
                })
            })

            console.log(months[month], date, firstday.getDay(), lastday, year, day, days[day]);
    </script>

</body>

</html>