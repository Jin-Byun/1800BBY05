<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>My BCIT Project</title>
    <meta name="comp1800 boilerplate code" content="my bcit project">
    <meta name="author" content="BCIT">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap, firebase-auth-ui -->
    <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.css" />

    <!-- Bootstrap FirebaseUI CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">

    <!-- Firebase 8 CDNs-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous">
    </script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>


    <!-- Link to the api keys for your firebase project -->
    <script src="scripts/firebaseAPI.js"></script>

    <!-- Optional styles and scripts of your own -->
    <!-- Google Icons (Material Design)-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.6.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="styles/my_style.css">

    <style>
        * {
            box-sizing: border-box;
        }

        body{

        background-color:#fffaec;
        }

        .navbar {

        background-color: #f5efdf  !important;
            border-bottom: solid 2px #f37f5230;
        }

        .navbar-brand {
        font-size: 5vh;
        font-weight: bold;
         color: #f37f52 !important;
         word-spacing: -1vh;
         line-height: 0;
         padding-top: 1.4vh;
         padding-bottom: 2.3vh;
         text-shadow:1px 0px yellow, 2px 0px 1px yellow, 2px 1px yellow, 1px 1px yellow, 2px 2px yellow, 3px 3px 1px #f37f52, 3px 0.5px 2px #f37f52;
    }
    
        .fixed-bottom {
        background-color:#f5efdf !important;
        border-top: solid 2px #f37f5230;
        }

        #app-calendar {
            /* border: solid black 2px; */
            width: 43vh;
            margin: 0 auto;
            display: grid;
            overflow: hidden;
            text-align: center;
            column-gap: 2px;
            row-gap: 4px;
            grid-template-columns: repeat(7, 1fr);
            grid-template-rows: 9% repeat(6, 1fr);
        }

        .block {
            display: flex;
            align-items: center;
            justify-content: center;
            border: rgba(0, 0, 0, 0.7) solid 2px;
            border-radius: 50%;
            font-size: 12pt;
            height: 100%;
        }

        .xtrablock {
            height: 100%;
        }

        .weekend {
            color: red;
        }

        .date {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: ivory;
            margin: auto 0;
            line-height: 100%;
            border-radius: 10px;
            border: black solid 1px;
            font-size: 10pt;
            font-weight: 800;
            height: 100%;
        }

        .today {
            text-shadow: 0 0 5px yellow;
            text-decoration: underline;
            border: solid green 2px;
        }

        .selected {
            background-color: brown;
        }

        .day {
            display: block;
            height: 100%;
            text-decoration: none;
        }

        .rem1, .rem2 {
            background-color: rgba(0, 255, 0, 0.4);
        }
        
        .rem3, .rem4 {
            background-color: rgba(255, 255, 0, 0.6);
        }

        .rem5, .rem6 {
            background-color: rgba(255, 0, 0, 0.8);
            color: yellow;
            font-weight: bold;
            border-color: black;
        }

        .rem7 {
            background-color: rgba(0, 0, 0, 1);
            color: black;
            border-color: gray;
            text-shadow: 0 0 6px whitesmoke;
        }
        .toprow {
            display: grid;
            width: 43vh;
            margin-top: 2%;
            margin-bottom: 2%;
            margin-inline: auto;
            text-align: center;
            grid-template-columns: 6% 88% 6%;
        }

        .btntop {
            line-height: 0; 
            padding-top: 0.4vh;
            font-size: 2vh;
            font-weight: 800;
            padding-inline: 0;
        }

        #date {
            line-height: 1.5;
            padding-bottom: 0;
            font-size: 2.35vh;
            font-weight: 700;
        }

        #prev {
            grid-column: 1 / span 1; 
            margin-right: auto;
        }

        #next {
            grid-column: 3 / span 1;
            margin-left: auto;
        }

        .fixed-bottom {
    background-color:#f5efdf !important;
    border-top: solid 2px #f37f5230;
    border-left: solid 2px #f37f5230;
    border-right: solid 2px #f37f5230;
    justify-content: space-evenly;
    margin-left: 10rem;
    margin-right: 10rem;
}


footer > a {
        color: #f37f52;
        text-shadow: 1px 0px #f37f52, -1px 0px #f37f52, 0px 1px #f37f52, 0px -1px #f37f52;
    }
    </style>

</head>

<body>

    <!-------------------------------------->
    <!-- The following is HTML for layout -->
    <!-------------------------------------->
    <!-- Header Navigation Bar -->
    <!-- Header Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-secondary">
        <div class="container-fluid">
            <a class="navbar-brand" href="./frontpage.html">HE J!</a>
        </div>
    </nav>

    <!-- welcome and main part of the page -->
    <div class="toprow">
    <button type="button" class="btn btntop" id="prev" onclick="go2PrevMonth()">&lt;</button>
    <div id="date" class="col"></div>
    <button type="button" class="btn btntop" id="next" onclick="go2nextMonth()">&gt;</button>
</div>

    <div id="app-calendar"></div>

    <br />
    <div class="row mx-5">
        <div class="col">
            <h1>Today's TO DO</h1>
        </div>
    </div>
    <div class="row mx-5">
        <div class="col-sm-1"></div>
        <div class="col-sm-7">
            <ul>
                <li>Eat lunch</li>
                <li>Walk the Dog</li>
                <li>Finish Assignment(due tmrw)</li>
            </ul>
        </div>
        <div class="col-sm-4 py-2"><input type="radio" class="btn-check a" name="btnradio" id="btnradio1"
                autocomplete="off" checked>
            <label class="btn btn-outline-secondary align-items-center" for="btnradio1">All Done</label></div>
    </div>
    <br />
    <div class="row mx-5">
        <div class="col">
            <h3>Quote of the day</h3>
        </div>
    </div>

    <div class="row mx-5">
        <div class="col">
            Lorem ipsum dolor sit amet consectetur adipisicing elit.
        </div>
    </div>

    <div style="height: 80px"></div>



    <div class="fixed-bottom py-3 bg-secondary align-items-center">
        <div class="container text-center py-0">
            <footer class="navbar bg-secondary fixed-bottom py-0">
                
                <a href="calendar.html" class="bi bi-calendar-date" style="font-size: 2em; "></a>
                <a href="create_schedule.html" class="bi bi-plus-circle mx-3" style="font-size: 3em;"></a>
                
                <a href="profile_user.html" i class="bi bi-person mx-3" style="font-size: 2em;"></a>
    
            </footer>
        </div>
    </div>

    <!--------------------------------------------------------------------->
    <!-- JS files: Your own JavaScript functions included here    -->
    <!--------------------------------------------------------------------->
    <script>
        //-------------
        //const and var
        //------------- 
        var userID;
        const calendar = document.querySelector("#app-calendar");
        const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September",
            "October", "November", "December"
        ]
        const days = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"]
        const fulldays = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"]
        const monthdays = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31]

        var today = new Date(Date.now());
        var month = today.getMonth();
        var date = today.getDate();
        var year = today.getFullYear();
        var day = today.getDay();
        var firstday = new Date(year, month, 1);
        var lastday = new Date(year, month + 1, 0);

        const nth = function (d) {
            if (d > 3 && d < 21) return 'th';
            switch (d % 10) {
                case 1:
                    return "st";
                case 2:
                    return "nd";
                case 3:
                    return "rd";
                default:
                    return "th";
            }
        }

        const isWeekend = block => {
            return block % 7 === ((1 + (7 - firstday.getDay())) % 7) || block % 7 === (7 - firstday.getDay());
        }

        const istoday = block => {
            return today.getFullYear() == year && today.getMonth() == month && block === date;
        }

        //-------------------------------------------------
        //---------------function and code-----------------
        //-------------------------------------------------
        getReminder();
        displayDate();

        function displayDate() {
        if (year == today.getFullYear() && month == today.getMonth()) {
        document.getElementById("date").innerHTML = year + " " + months[month] + " " + date + nth(date) + ", " +
            fulldays[day];
        } else {
            document.getElementById("date").innerHTML = year + " " + months[month];
        }}
        function go2PrevMonth() {
            month -= 1;
            if (month < 0) {
                month = 11;
                year -= 1;
            }
            firstday = new Date(year, month, 1);
            displayDate();
            document.getElementById("app-calendar").innerHTML = "";
            getReminder();
        }
        
        function go2nextMonth() {
            month += 1;
            if (month > 11) {
                month = 0;
                year += 1;
            }
            firstday = new Date(year, month, 1);
            displayDate();
            document.getElementById("app-calendar").innerHTML = "";
            getReminder();
        }

        // --------------------------------------
        // Making calendar
        // --------------------------------------
        function fillCalendar() {
            for (let i = 0; i < 7; i++) {
                calendar.insertAdjacentHTML("beforeend",
                    `<div class="date ${i == 0 || i == 6 ? "weekend" : ""}">${days[i]}</div>`);
            }
            for (let xtrablock = 0; xtrablock < firstday.getDay(); xtrablock++) {
                calendar.insertAdjacentHTML("beforeend", `<div class="xtrablock"></div>`);
            }
            for (let block = 1; block <= monthdays[month]; block++) {
                const weekend = isWeekend(block);
                const now = istoday(block);
                calendar.insertAdjacentHTML("beforeend",
                    `<a class ="day" href="./day.html?uid=${userID}?${year}?${months[month]}?${block}"><div id="${year+'_'+month+'_'+block}" class="day${(firstday.getDay() + block - 1) % 7} block ${weekend ? "weekend" : ""} ${now ? "today" : ""}">${block}</div></a>`
                );
            }
            if (firstday.getDay() == 5 && monthdays[month] > 30 || firstday.getDay() == 6 && monthdays[month] >= 30) {
                document.getElementById('app-calendar').style.gridTemplateRows = `7.5% repeat(6, 1fr)`;
                document.getElementById('app-calendar').style.height = `41.65vh`;
            } else {
                document.getElementById('app-calendar').style.gridTemplateRows = `9% repeat(5, 1fr)`;
                document.getElementById('app-calendar').style.height = `35.25vh`;
            }
        }
        //-------------------------
        //Get reminder
        //-------------------------
        function getReminder() {
        firebase.auth().onAuthStateChanged(user => {
            if (user) {
                userID = user.uid;
                fillCalendar();
                var activities = [];
                var reminderRef = db.collection("reminders");
                reminderRef.where("UserID", "==", userID).get()
                    .then((querySnapshot) => {
                        querySnapshot.forEach((doc) => {
                            activities.push(doc.data());
                            //             // doc.data() is never undefined for query doc snapshots
                        });
                        let dailies = [];
                        let weeklies = [];
                        let biweeklies = [];
                        activities.forEach(element => {
                            if (element.Frequency == "Daily") {
                                dailies.push(new Date(element.TimeStamp));
                            } else if (element.Frequency == "Weekly") {
                                weeklies.push(new Date(element.TimeStamp));
                            } else {
                                biweeklies.push(new Date(element.TimeStamp));
                            }
                        });
                        for (let i = 0; i < dailies.length; i++) {
                            if (year > dailies[i].getFullYear() || (year == dailies[i].getFullYear() &&
                                    month > dailies[i].getMonth())) {
                                let dailychange = document.querySelectorAll("#app-calendar .block");
                                for (let index = 0; index < dailychange.length; index++) {
                                    addReminderClass(dailychange, index);
                                }
                            } else
                            if (year == dailies[i].getFullYear() && month == dailies[i].getMonth()) {
                                let dailychange = document.querySelectorAll("#app-calendar .block");
                                for (let index = 0; index < dailychange.length; index++) {
                                    if (dailychange[index].innerHTML >= dailies[i].getDate()) {
                                        addReminderClass(dailychange, index);
                                    }
                                }
                            }
                        }
                        for (let i = 0; i < weeklies.length; i++) {
                            if (year > weeklies[i].getFullYear() || (year == weeklies[i].getFullYear() &&
                                    month > weeklies[i].getMonth())) {
                                let dailychange = document.querySelectorAll("#app-calendar .block");
                                for (let index = 0; index < dailychange.length; index++) {
                                    if (dailychange[index].classList.contains('day' + weeklies[i]
                                    .getDay())) {
                                        addReminderClass(dailychange, index);
                                    }
                                }
                            } else
                            if (year == weeklies[i].getFullYear() && month == weeklies[i].getMonth()) {
                                let dailychange = document.querySelectorAll("#app-calendar .block");
                                for (let index = 0; index < dailychange.length; index++) {
                                    if (dailychange[index].innerHTML >= dailies[i].getDate()) {
                                        // console.log(dailychange[index].classList.contains('rem1'));
                                        if (dailychange[index].classList.contains('day' + weeklies[i]
                                                .getDay())) {
                                            addReminderClass(dailychange, index);
                                        }
                                    }
                                }
                            }
                        }
                        for (let i = 0; i < biweeklies.length; i++) {
                            if (year > biweeklies[i].getFullYear() || (year == biweeklies[i].getFullYear() &&
                                    month > biweeklies[i].getMonth())) {
                                let dailychange = document.querySelectorAll("#app-calendar .block");
                                for (let index = 0; index < dailychange.length; index++) {
                                    if (dailychange[index].classList.contains('day' + biweeklies[i]
                                    .getDay())) {
                                        if ((Math.floor(new Date(year, month, index+1)/(3600*1000*24)) - Math.floor(biweeklies[i].getTime()/(3600*1000*24))) % 14 == 0){
                                        addReminderClass(dailychange, index);
                                    }}
                                }
                            } else
                            if (year == biweeklies[i].getFullYear() && month == biweeklies[i].getMonth()) {
                                let dailychange = document.querySelectorAll("#app-calendar .block");
                                for (let index = 0; index < dailychange.length; index++) {
                                    if (dailychange[index].innerHTML >= biweeklies[i].getDate()) {
                                        // console.log(dailychange[index].classList.contains('rem1'));
                                        if (dailychange[index].classList.contains('day' + biweeklies[i]
                                                .getDay())) {
                                                    if ((Math.floor(new Date(year, month, index+1)/(3600*1000*24)) - Math.floor(new Date(biweeklies[i].getFullYear(),biweeklies[i].getMonth(), biweeklies[i].getDate())/(3600*1000*24))) % 14 == 0){
                                            addReminderClass(dailychange, index);
                                        }
                                        }
                                    }
                                }
                            }
                        }
                    })
            } else {
                //     // User is signed out
                //     // ...
            }
        });
    }
        function addReminderClass(classArr, index) {
            if (classArr[index].classList.contains('rem6')) {
                classArr[index].classList.add('rem7');
            } else if (classArr[index].classList.contains('rem5')) {
                classArr[index].classList.add('rem6');
            } else if (classArr[index].classList.contains('rem4')) {
                classArr[index].classList.add('rem5');
            } else if (classArr[index].classList.contains('rem3')) {
                classArr[index].classList.add('rem4');
            } else if (classArr[index].classList.contains('rem2')) {
                classArr[index].classList.add('rem3');
            } else if (classArr[index].classList.contains('rem1')) {
                classArr[index].classList.add('rem2');
            } else {
                classArr[index].classList.add('rem1');
            }
        }

        // May not need area (temporary garbage can)
                // addDate2db();


        // adding dates into db collection.
        // function addDate2db() {
        //     for (let i = 1; i <= monthdays[month]; i++) {
        //         firebase.auth().onAuthStateChanged(user => {
        //             if (user) {
        //                 var currentUser = db.collection("users").doc(user.uid)
        //                 userID = user.uid;
        //                 //get the document for current user.
        //                 currentUser.get()
        //                     .then(userDoc => {
        //                         //get user name
        //                         userName = userDoc.data().name;
        //                         // Start a new collection and add all data in it.
        //                         let docData = {
        //                             reminder: "",
        //                             name: userName
        //                         };
        //                         db.collection("dates").doc(userID)
        //                             .collection(months[month] + "_" + year)
        //                             .doc(i.toString()).collection("todo").set(docData).then(() => {
        //                                 console.log("Document successfully written!");
        //                             });
        //                     })
        //             } else {}
        //         })
        //     }
        // }
    </script>

</body>

</html>